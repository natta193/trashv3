<!DOCTYPE html>
<html>
<head>
    <title>Pi Vision Arm Control</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f0f0f0;
            margin-top: 50px;
        }
        #video_container {
            margin: 20px auto;
            border: 2px solid #333;
            width: fit-content;
        }
        .video_feed {
            display: block;
            max-width: 100%;
            height: auto;
        }
        .debug_feed {
            display: block;
            max-width: 100%;
            height: auto;
            /* Make debug view larger */
            min-width: 400px;
            min-height: 300px;
        }
        #status {
            margin-top: 20px;
            font-size: 1.2em;
            color: #555;
        }
    </style>
</head>
<body>
    <h1>Live Vision for Robotic Arm Control</h1>
    <div id="video_container">
        <div style="display: flex; justify-content: center; gap: 20px; margin: 20px 0;">
            <div style="text-align: center;">
                <h3>Normal View</h3>
                <img src="{{ url_for('video_feed') }}" alt="Live Video Feed" class="video_feed" style="border: 2px solid #333;">
            </div>
            <div style="text-align: center;">
                <h3>AI Debug View</h3>
                <img src="{{ url_for('debug_feed') }}" alt="Debug Video Feed" class="debug_feed" style="border: 2px solid #333;">
            </div>
        </div>
    </div>
    <div id="perf_stats" style="margin-top:20px; font-size:1.1em;">
        <b>Performance:</b>
        <span id="fps">FPS: ...</span> |
        <span id="cpu">CPU: ...</span> |
        <span id="cpu_temp">CPU Temp: ...</span> |
    </div>
    
    <div id="controls" style="margin-top:20px;">
        <button id="calibrate_btn" onclick="calibrateServos()" style="padding:10px 20px; font-size:1.1em; background-color:#28a745; color:white; border:none; border-radius:5px; cursor:pointer; margin-left:10px;">
            Calibrate Servos
        </button>
        <!-- <button id="start_browser_btn" onclick="startBrowser()" style="padding:10px 20px; font-size:1.1em; background-color:#007bff; color:white; border:none; border-radius:5px; cursor:pointer; margin-left:10px;"> -->
        <button id="start_browser_btn" onclick="startBrowser()" style="display: none;">
            Start Browser
        </button>
        <!-- <button id="stop_browser_btn" onclick="stopBrowser()" style="padding:10px 20px; font-size:1.1em; background-color:#dc3545; color:white; border:none; border-radius:5px; cursor:pointer; margin-left:10px;"> -->
        <button id="stop_browser_btn" onclick="startBrowser()" style="display: none;">
            Stop Browser
        </button>
        <button id="motor_stop_btn" onclick="motorStop()" style="padding:10px 20px; font-size:1.1em; background-color:#ffc107; color:white; border:none; border-radius:5px; cursor:pointer; margin-left:10px;">
            Stop Motor
        </button>
    </div>

<script>
function updateStats() {
    fetch('/stats')
        .then(response => response.json())
        .then(data => {
            document.getElementById('fps').textContent = 'FPS: ' + data.fps.toFixed(1);
            document.getElementById('cpu').textContent = 'CPU: ' + data.cpu.toFixed(1) + '%';
            document.getElementById('cpu_temp').textContent = 'CPU Temp: ' + data.cpu_temp.toFixed(1) + 'Â°C';
        });
}

function motorStop() {
    const btn = document.getElementById('motor_stop_btn');
    btn.disabled = true;
    btn.textContent = 'Stopping motor...';
    
    fetch('/motor_stop')
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                showMessage(data.message, 'success');
            } else {
                showMessage('Error: ' + data.message, 'error');
            }
        })
        .catch(error => {
            console.error('Error stopping motor:', error);
            showMessage('Error stopping motor', 'error');
        })
        .finally(() => {
            btn.disabled = false;
            btn.textContent = 'Stop Motor';
        });
}

function calibrateServos() {
    const btn = document.getElementById('calibrate_btn');
    btn.disabled = true;
    btn.textContent = 'Calibrating...';
    
    fetch('/calibrate')
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                showMessage(data.message, 'success');
            } else {
                showMessage('Error: ' + data.message, 'error');
            }
        })
        .catch(error => {
            console.error('Error calibrating:', error);
            showMessage('Error calibrating servos', 'error');
        })
        .finally(() => {
            btn.disabled = false;
            btn.textContent = 'Calibrate Servos';
        });
}

function startBrowser() {
    const btn = document.getElementById('start_browser_btn');
    btn.disabled = true;
    btn.textContent = 'Starting browser...';
    
    fetch('/start_browser')
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                showMessage(data.message, 'success');
            } else {
                showMessage('Error: ' + data.message, 'error');
            }
        })
        .catch(error => {
            console.error('Error starting browser:', error);
            showMessage('Error starting browser', 'error');
        })
        .finally(() => {
            btn.disabled = false;
            btn.textContent = 'Start Browser';
        });
}

function stopBrowser() {
    const btn = document.getElementById('stop_browser_btn');
    btn.disabled = true;
    btn.textContent = 'Stopping browser...';
    
    fetch('/stop_browser')
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                showMessage(data.message, 'success');
            } else {
                showMessage('Error: ' + data.message, 'error');
            }
        })
        .catch(error => {
            console.error('Error stopping browser:', error);
            showMessage('Error stopping browser', 'error');
        })
        .finally(() => {
            btn.disabled = false;
            btn.textContent = 'Stop Browser';
        });
}

function showMessage(message, type) {
    // Create or update message element
    let msgElement = document.getElementById('message');
    if (!msgElement) {
        msgElement = document.createElement('div');
        msgElement.id = 'message';
        msgElement.style.cssText = 'position:fixed; top:20px; right:20px; padding:15px; border-radius:5px; color:white; font-weight:bold; z-index:1000;';
        document.body.appendChild(msgElement);
    }
    
    msgElement.textContent = message;
    msgElement.style.backgroundColor = type === 'success' ? '#28a745' : '#dc3545';
    
    // Auto-hide after 3 seconds
    setTimeout(() => {
        msgElement.style.display = 'none';
    }, 3000);
}

// Update stats every second
setInterval(updateStats, 1000);

// Initialize on page load
updateStats();
</script>
</body>
</html>

